<meta charset="utf-8"/>
<!--
Show 100 either avlonia's or bevlonia's, with them having to decide which is which.

1) Fetch from server what the category I am learning is, and what the foil category is.
This needs to not be random but chosen so that pairs of subjects see the same categories
as each other but learn a different one (swaps foil and target category). Foil category
is always a different feature.

2) Half of them have to have the target feature and half also have to the foil feature,
with half overlap. So 25 avolnia, 25 bev., 25 both, 25 neither.

3) Break to explain instructions.

4) Again generate 25 of each overlap, this time for the person to study for 3s/item.

5) Then memory test. 80 old items, 20 of each kind. 90 new items: 30 avlonias, 30
bevlonias, 30 of neither.
-->

<style>
.categorizeImage {
  display:none;
}

#question {
  display:none;
}

#instrucBox {
  font-family: Arial, sans-serif;
  font-style: italic;
  margin: 10px auto;
  width:500px;
}

#experimentBox {
  margin: 30px auto;
  margin-top: 10px;
  width:500px;
  height: 500px;
  border: 1px solid gray;
  text-align:center;
}

.textInBox {
  position: relative;
  font-size: 16pt;
  color: #222;
  font-family: Arial, sans-serif;
  top: 200px;
  display: none;
}

.buttonStart {
  font-size: 16pt;
  font-family: Arial, sans-serif;
}

#wrong {
  color: maroon;
}

#correct {
  color: green;
}

#done {
  display: none;
}

#timSubmit {
  font-weight: bold;
  color: black;
  border: 3px outset gray;
  background: #CCC;
  padding: 5px;
  text-decoration: none;
}

#timSubmit:hover {
  border: 3px solid gray;
}

#timSubmit:active {
  border: 3px inset gray;
}

.instrucBox {
  font-family: Arial, sans-serif;
  line-height: 1.4em;
  margin: 30px auto;
  width:500px;
}

#instrucBox {
  display: none;
}
#experimentBox {
  display: none;
}
#studyInstruc {
  display: none;
}
#testInstruc {
  display: none;
}

#trialCnt {
  float: right;
}

#startExperiment {
  display: none;
}
</style>

<div class="instrucBox" id="categoryInstruc1" style="padding:5px; text-align:left">
<p>This HIT will involve 3 short tasks, all involving pictures of insects. It should take approximately 12-15 minutes to do all 3 tasks.</p>
<p>During the first task, you will see one insect at a time and have to determine whether or not it is a <b></b>. Acoptera is a particular species of insect. They are different from all other insects in one simple way -- and your job is to find out what that is. For example, it could be that acoptera all have 3 body segments, but no other insects do. Or acoptera could be the only insects that have a pink antenna; or a round-shaped body segment; or green wings.</p>
<p><img src="http://web-mir.ccn.duke.edu/flower/images/insects/insect_1_triangle_2_purple_1_green.png" width=245><img src="http://web-mir.ccn.duke.edu/flower/images/insects/insect_1_circle_1_orange_2_blue.png" width=245></p>
<p>As you can see from these examples, the insects in this experiment will differ in a number of ways: (1) the number of antennae, (2) the color of the antennae, (3) the shape of the body segments, (4) the number of their body segments, and (5) the color of their wings. One of these features will determine what is and is not an acoptera.</p>
<p>In the first task, you'll be shown a single insect, and then be asked if it is or not an acoptera (press 'y' if yes, 'n' if no). At first, you'll have to guess. Eventually, though, you'll figure out what makes something an acoptera. You will have <span id="numLearning">0</span> insects to judge. Do your best to determine what makes something an acoptera.</p><br>
<p><a href="#" class="buttonStart" id="startLearning">I'm Ready to Start Part 1</a><span class="buttonStart" id="loading">Loading images... Please wait.</span></p><br>
<p><small>By answering the following questions, you are participating in a study being performed by psychologists in the Duke Department of Psychology and Neuroscience. If you have questions about this research, please contact Felipe De Brigard at felipe.debrigard@duke.edu. Your participation in this research is voluntary. You may decline to answer any or all of the following questions. You may decline further participation, at any time, without adverse consequences. Your anonymity is assured; the researchers who have requested your participation will not receive any personal information about you.</small></p>
</div>

<div class="instrucBox" id="studyInstruc" style="padding:5px; text-align:left">
<p>Great job!</p>
<p>During the second task, you will have to remember insects. You'll be shown <span id="numStudy">0</span> insects, one at a time, for just a few seconds each. Do your best to remember these insects as well as you can. If you remember a large number of them successfully, you'll likely get bonus pay.
<p>Some of the insects you have to remember might be acoptera and some might not.</p>
<p><a class="buttonStart" href="#" id="startStudy">Start memory task</a></p>
</div>

<div class="instrucBox" id="testInstruc" style="padding:5px; text-align:left">
<p>Great job!</p>
<p>During the third and final task, you will have to say which insects you saw in the previous part and which you didn't. You'll be shown <span id="numTest">0</span> insects, one at a time. Some you will have seen before, and some you won't have seen. For each insect, you have to say whether you saw it before. If you did see it, press the 'y' key. If you didn't, press the 'n' key. Please do your best!</p>
<p><a class="buttonStart" href="#" id="startTest">Start memory test</a></p>
</div>


<div id="instrucBox"><span id="instrucTextCur">Do you think this is an acoptera? <b>(y/n)</b></span><span id="trialCnt">Trial 1 of 100</span></div>
<div id="experimentBox">
<div id="imagesForLearning"></div>
<div id="imagesForStudy"></div>
<div id="imagesForTest"></div>
<div class="textInBox" id="question">Was this an acoptera?<br><br>y / n</div>
<div class="textInBox" id="correct">Correct!</div>
<div class="textInBox" id="wrong">Incorrect!</div>

<div class="textInBox" id="done" style="top:60px">Done! You got <span id="numRight">0</span> out of <span id="numTotal">0</span> correct.<br><br>Any comments for us?<br><br>
<textarea name="comments" id="comments" style="width: 300px; height: 200px"></textarea><br><br>
<a href="#" id="timSubmit">Submit</a>
</div>
<div class="textInBox" id="saving">Saving . . .</div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
<script src="http://web-mir.ccn.duke.edu/flower/TimTurkTools.js"></script>
<script src="category_learning.js"></script>
<script>
/* Define the values for each feature */
var values = {'segment_count':['1', '2', '3'],
              'segment_shape':['circle', 'triangle', 'rectangle'],
              'wing_color':['blue', 'yellow', 'green'],
              'antennae_count':['1', '2', '4'],
              'antennae_color':['purple', 'orange', 'lightblue']};

/* List of feature names */
var features = Object.keys(values);

/* Define the learned and foil categories
   - these should be fetched from a server */
var featureLearned = features[Math.floor(Math.random()*features.length)];
var featureFoil = features[Math.floor(Math.random()*features.length)];
while (featureLearned == featureFoil) {
  featureFoil = features[Math.floor(Math.random()*features.length)];
}
var valueLearned = values[featureLearned][Math.floor(Math.random()*values[featureLearned].length)];
var valueFoil = values[featureFoil][Math.floor(Math.random()*values[featureFoil].length)];

/* For now, output the learned features */
console.log('learned feature: ' + featureLearned);
console.log('learned value: ' + valueLearned);
console.log('unlearned feature: ' + featureFoil);
console.log('unlearned value: ' + valueFoil);

/* Get filename for an object */
function GetFilename(obj) {
  return ('http://web-mir.ccn.duke.edu/flower/images/insects/insect_'
    + obj.segment_count + "_" + obj.segment_shape + "_"
    + obj.antennae_count + "_" + obj.antennae_color
    + '_1_' + obj.wing_color + ".png");
}

/* Parameters for stimuli */
var nLearning = 54;
var pLearnedLearning = 1/3.0;
var pFoilLearning = 1/3.0;

var nStudy = 18;
var pLearnedStudy = 1/3.0;
var pFoilStudy = 1/3.0;

var nTest = 54;
var pLearnedTest = 1/3.0;  // p for lures, not old items
var pFoilTest = 1/3.0;

console.log('pLearnedLearning: ' + pLearnedLearning);
console.log('pFoilLearning: ' + pFoilLearning);
console.log('pLearnedStudy: ' + pLearnedStudy);
console.log('pFoilStudy: ' + pFoilStudy);
console.log('pLearnedTest: ' + pLearnedTest);
console.log('pFoilTest: ' + pFoilTest);

/* Build the lists of items to use for learning, study, and test */
var itemsForLearning = CreateLearningList(nLearning, pLearnedLearning, pFoilLearning,
                                          values, featureLearned, valueLearned,
                                          featureFoil, valueFoil, GetFilename);
var itemsForStudy = CreateStudyList(nStudy, itemsForLearning, pLearnedStudy, pFoilStudy,
                                    values, featureLearned, valueLearned,
                                    featureFoil, valueFoil, GetFilename);
var itemsForTest = CreateTestList(nTest, itemsForLearning, itemsForStudy,
                                  pLearnedTest, pFoilTest, values,
                                  featureLearned, valueLearned,
                                  featureFoil, valueFoil, GetFilename);

var orderLearning = RandomOrder(nLearning);
var orderStudy = RandomOrder(nStudy);
var orderTest = RandomOrder(nTest);

/* On page load */
$(StartExperiment('insect_E5', featureLearned, valueLearned, featureFoil, valueFoil,
                  itemsForLearning, orderLearning, itemsForStudy,
                  orderStudy, itemsForTest, orderTest));
</script>
